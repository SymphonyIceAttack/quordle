/**
 * 高级词库系统
 * - 动态加载真实开源词库
 * - 按难度/词频分类
 * - 支持主题过滤
 * - 基于日期的确定性选择
 */

import fs from "node:fs/promises";
import path from "node:path";

// 词频数据 (前300个最常见5字母单词)
const COMMON_5_LETTER_WORDS = new Set([
  "ABACK",
  "ABOUT",
  "ABOVE",
  "ACORN",
  "ACTOR",
  "ACUTE",
  "ADAPT",
  "ADMIT",
  "ADORE",
  "ADULT",
  "AFTER",
  "AGAIN",
  "AGENT",
  "AGILE",
  "AGREE",
  "AHEAD",
  "AIMED",
  "AISLE",
  "ALARM",
  "ALBUM",
  "ALERT",
  "ALIEN",
  "ALIGN",
  "ALIKE",
  "ALIVE",
  "ALLOW",
  "ALLOY",
  "ALONG",
  "ALPHA",
  "ALTER",
  "AMBER",
  "AMEND",
  "AMONG",
  "AMUSE",
  "ANGEL",
  "ANGER",
  "ANGLE",
  "ANGRY",
  "ANKLE",
  "ANNOY",
  "APART",
  "APPLE",
  "APPLY",
  "APRIL",
  "ARENA",
  "ARGUE",
  "ARISE",
  "ARROW",
  "ASHEN",
  "ASIDE",
  "ASSET",
  "ATLAS",
  "ATOLL",
  "AUDIO",
  "AUGUR",
  "AVAIL",
  "AVOID",
  "AWAIT",
  "AWAKE",
  "AWARE",
  "BACON",
  "BADGE",
  "BASIC",
  "BEACH",
  "BEAMY",
  "BEARD",
  "BEAST",
  "BEATS",
  "BEECH",
  "BEEFY",
  "BEGAN",
  "BEGUN",
  "BEING",
  "BELCH",
  "BELIE",
  "BELLY",
  "BELTS",
  "BENCH",
  "BENDY",
  "BERRY",
  "BIRTH",
  "BISON",
  "BLACK",
  "BLADE",
  "BLAME",
  "BLAND",
  "BLAST",
  "BLAZE",
  "BLEAK",
  "BLEED",
  "BLEND",
  "BLESS",
  "BLIND",
  "BLINK",
  "BLISS",
  "BLOAT",
  "BLOCK",
  "BLOKE",
  "BLOND",
  "BLOOD",
  "BLOOM",
  "BLOWS",
  "BLUER",
  "BLUFF",
  "BLUNT",
  "BLUSH",
  "BOARD",
  "BOAST",
  "BONEY",
  "BONGO",
  "BONUS",
  "BOOKS",
  "BOOST",
  "BOOTH",
  "BOOTY",
  "BORAX",
  "BORNE",
  "BOSOM",
  "BOSSY",
  "BOTCH",
  "BOUGH",
  "BOUND",
  "BOWEL",
  "BOWLS",
  "BOXER",
  "BRACE",
  "BRAID",
  "BRAIN",
  "BRAKE",
  "BRAND",
  "BRASH",
  "BRASS",
  "BRAVE",
  "BRAVO",
  "BRAWL",
  "BREAD",
  "BREAK",
  "BREED",
  "BRICK",
  "BRIDE",
  "BRIEF",
  "BRINE",
  "BRING",
  "BRINK",
  "BRISK",
  "BROAD",
  "BROIL",
  "BROKE",
  "BROOD",
  "BROOK",
  "BROOM",
  "BROWN",
  "BROWS",
  "BRUSH",
  "BRUTE",
  "BUDDY",
  "BUGGY",
  "BUGLE",
  "BUILD",
  "BUILT",
  "BULGE",
  "BULKY",
  "BULLY",
  "BUNCH",
  "BURLY",
  "BURNT",
  "BURST",
  "BUSHY",
  "BUSTY",
  "CABAL",
  "CABIN",
  "CABLE",
  "CACHE",
  "CADET",
  "CAGEY",
  "CAKES",
  "CALLS",
  "CALVE",
  "CAMEL",
  "CAMEO",
  "CANAL",
  "CANDY",
  "CANOE",
  "CANON",
  "CAPER",
  "CAPUT",
  "CARAT",
  "CARGO",
  "CAROL",
  "CARVE",
  "CASED",
  "CASTE",
  "CATCH",
  "CATER",
  "CAUSE",
  "CAVIL",
  "CEASE",
  "CEDAR",
  "CELLO",
  "CELTS",
  "CENTS",
  "CHAFE",
  "CHAIR",
  "CHALK",
  "CHAMP",
  "CHANT",
  "CHAOS",
  "CHARD",
  "CHARM",
  "CHART",
  "CHASE",
  "CHEAP",
  "CHEAT",
  "CHECK",
  "CHEER",
  "CHESS",
  "CHEST",
  "CHICK",
  "CHIDE",
  "CHIEF",
  "CHILD",
  "CHILI",
  "CHILL",
  "CHIME",
  "CHINA",
  "CHIRP",
  "CHOIR",
  "CHOKE",
  "CHORD",
  "CHORE",
  "CHOSE",
  "CHUCK",
  "CHURN",
  "CHUTE",
  "CIDER",
  "CIGAR",
  "CINCH",
  "CIVIC",
  "CIVIL",
  "CLAIM",
  "CLAMP",
  "CLANG",
  "CLASH",
  "CLASP",
  "CLASS",
  "CLEAN",
  "CLEAR",
  "CLERK",
  "CLIFF",
  "CLIMB",
  "CLING",
  "CLINK",
  "CLOAK",
  "CLOCK",
  "CLONE",
  "CLOSE",
  "CLOTH",
  "CLOUD",
  "CLOUT",
  "CLOVE",
  "CLOWN",
  "COACH",
  "COAST",
  "COBRA",
  "COCOA",
  "CODED",
  "CODER",
  "CODES",
  "CODEX",
  "COILS",
  "COINS",
  "COLON",
  "COLOR",
  "COMET",
  "COMFY",
  "COMIC",
  "COMMA",
  "CONCH",
  "CONDO",
  "CONIC",
  "COOKS",
  "COOLS",
  "COPED",
  "COPES",
  "COPPER",
  "CORAL",
  "CORER",
  "CORES",
  "CORNY",
  "CORPS",
  "COSTS",
  "COUCH",
  "COUGH",
  "COUNT",
  "COUPE",
  "COUPLE",
  "COURT",
  "COVER",
  "COVET",
  "COVEY",
  "COWER",
  "COYLY",
  "CRACK",
  "CRAFT",
  "CRANE",
  "CRANK",
  "CRASH",
  "CRATE",
  "CRAVE",
  "CRAWL",
  "CRAZE",
  "CRAZY",
  "CREAK",
  "CREAM",
  "CREDO",
  "CREED",
  "CREEK",
  "CREEP",
  "CREPE",
  "CREPT",
  "CRESS",
  "CREST",
  "CRICK",
  "CRIED",
  "CRIER",
  "CRIME",
  "CRIMP",
  "CRISP",
  "CROAK",
  "CROCK",
  "CRONE",
  "CRONY",
  "CROOK",
  "CROON",
  "CROPS",
  "CROSS",
  "CROWD",
  "CROWN",
  "CRUDE",
  "CRUEL",
  "CRUMB",
  "CRUSH",
  "CRUST",
  "CRYPT",
  "CUBIC",
  "CUMIN",
  "CURIO",
  "CURLY",
  "CURRY",
  "CURSE",
  "CURVE",
  "CURVY",
  "CUTER",
  "CUTIE",
  "CYCLE",
  "CYNIC",
  "DAILY",
  "DAIRY",
  "DAISY",
  "DANCE",
  "DANDY",
  "DATED",
  "DEALT",
  "DEATH",
  "DEBIT",
  "DEBUT",
  "DECAL",
  "DECAY",
  "DECOR",
  "DECOY",
  "DEEDS",
  "DEFER",
  "DEIFY",
  "DEIGN",
  "DEITY",
  "DELTA",
  "DELVE",
  "DEMON",
  "DEMUR",
  "DENIM",
  "DENSE",
  "DEPOT",
  "DEPTH",
  "DERBY",
  "DETER",
  "DETOX",
  "DEUCE",
  "DEVIL",
  "DIARY",
  "DICEY",
  "DIGIT",
  "DINER",
  "DIRGE",
  "DIRTY",
  "DISCO",
  "DITCH",
  "DITTO",
  "DITTY",
  "DIVER",
  "DIZZY",
  "DODGE",
  "DODGY",
  "DOGMA",
  "DOING",
  "DOLLY",
  "DONOR",
  "DONUT",
  "DOOMS",
  "DOORS",
  "DOUBT",
  "DOUGH",
  "DOUSE",
  "DOVES",
  "DOWEL",
  "DOWNY",
  "DOWRY",
  "DOZEN",
  "DRAFT",
  "DRAIN",
  "DRAMA",
  "DRANK",
  "DRAPE",
  "DRAWN",
  "DREAD",
  "DREAM",
  "DRESS",
  "DRIED",
  "DRIER",
  "DRIFT",
  "DRILL",
  "DRINK",
  "DRIVE",
  "DROIT",
  "DROLL",
  "DRONE",
  "DROOL",
  "DROOP",
  "DROSS",
  "DROVE",
  "DROWN",
  "DRUID",
  "DRYER",
  "DRYLY",
  "DUCKS",
  "DULLY",
  "DUMMY",
  "DUMPY",
  "DUSKY",
  "DUSTY",
  "DUTCH",
  "DWARF",
  "DWELL",
  "DWELT",
  "DYING",
  "EAGER",
  "EARLY",
  "EARTH",
  "EASEL",
  "EATEN",
  "EATER",
  "EBONY",
  "ECLAT",
  "EDICT",
  "EDIFY",
  "EERIE",
  "EGRET",
  "EIGHT",
  "EJECT",
  "ELATE",
  "ELBOW",
  "ELDER",
  "ELECT",
  "ELFIN",
  "ELIDE",
  "ELITE",
  "ELOPE",
  "ELUDE",
  "EMAIL",
  "EMBER",
  "EMCEE",
  "EMPTY",
  "ENACT",
  "ENDED",
  "ENEMY",
  "ENJOY",
  "ENNUI",
  "ENSUE",
  "ENTER",
  "ENTRY",
  "ENVOY",
  "EPOCH",
  "EPOXY",
  "EQUAL",
  "EQUIP",
  "ERASE",
  "ERECT",
  "ERODE",
  "ERROR",
  "ERUPT",
  "ESSAY",
  "ETHER",
  "ETHIC",
  "ETHOS",
  "ETUDE",
  "EVADE",
  "EVENT",
  "EVERY",
  "EVICT",
  "EVOKE",
  "EXACT",
  "EXALT",
  "EXCEL",
  "EXERT",
  "EXILE",
  "EXIST",
  "EXITS",
  "EXPEL",
  "EXTRA",
  "EXULT",
  "FABLE",
  "FACET",
  "FADED",
  "FAINT",
  "FAIRY",
  "FAITH",
  "FALSE",
  "FANCY",
  "FARCE",
  "FARED",
  "FARMS",
  "FATAL",
  "FAULT",
  "FAUNA",
  "FAVOR",
  "FEAST",
  "FEATS",
  "FECAL",
  "FEIGN",
  "FEINT",
  "FELON",
  "FEMME",
  "FENCE",
  "FERAL",
  "FERRY",
  "FETCH",
  "FETID",
  "FETUS",
  "FEVER",
  "FIBER",
  "FICUS",
  "FIELD",
  "FIEND",
  "FIERY",
  "FIFTH",
  "FIFTY",
  "FIGHT",
  "FILLY",
  "FILMS",
  "FILTH",
  "FINAL",
  "FINCH",
  "FINER",
  "FIRST",
  "FISHY",
  "FIXED",
  "FIXER",
  "FJORD",
  "FLACK",
  "FLAIR",
  "FLAKE",
  "FLAME",
  "FLANK",
  "FLARE",
  "FLASH",
  "FLASK",
  "FLECK",
  "FLEET",
  "FLESH",
  "FLICK",
  "FLIER",
  "FLING",
  "FLINT",
  "FLIRT",
  "FLOAT",
  "FLOOD",
  "FLOOR",
  "FLORA",
  "FLOSS",
  "FLOUR",
  "FLOUT",
  "FLUFF",
  "FLUID",
  "FLUKE",
  "FLUME",
  "FLUSH",
  "FLUTE",
  "FOCAL",
  "FOCUS",
  "FOGGY",
  "FOIST",
  "FOLDS",
  "FOLKS",
  "FOLLY",
  "FORCE",
  "FORGE",
  "FORGO",
  "FORTH",
  "FORTY",
  "FORUM",
  "FOUND",
  "FOYER",
  "FRAIL",
  "FRAME",
  "FRANK",
  "FRAUD",
  "FREAK",
  "FREED",
  "FRESH",
  "FRETS",
  "FRIAR",
  "FRIED",
  "FRILL",
  "FRISK",
  "FROCK",
  "FROGS",
  "FRONT",
  "FROST",
  "FROTH",
  "FROWN",
  "FROZE",
  "FRUIT",
  "FUDGY",
  "FUGUE",
  "FULLY",
  "FUNGI",
  "FUNNY",
  "FURRY",
  "FUSSY",
  "FUZZY",
  "GAFFE",
  "GAINS",
  "GAMER",
  "GAMMA",
  "GAMUT",
  "GASSY",
  "GAUDY",
  "GAUGE",
  "GAUNT",
  "GAUZE",
  "GEARS",
  "GECKO",
  "GEEKY",
  "GEESE",
  "GENIE",
  "GENRE",
  "GHOST",
  "GHOUL",
  "GIANT",
  "GIDDY",
  "GIRTH",
  "GIVEN",
  "GLADE",
  "GLAND",
  "GLARE",
  "GLASS",
  "GLAZE",
  "GLEAM",
  "GLEAN",
  "GLIDE",
  "GLINT",
  "GLOBE",
  "GLOOM",
  "GLORY",
  "GLOSS",
  "GLOVE",
  "GLUED",
  "GLYPH",
  "GNASH",
  "GNOME",
  "GOING",
  "GOODS",
  "GOOEY",
  "GOOSE",
  "GORGE",
  "GRACE",
  "GRADE",
  "GRAFT",
  "GRAIL",
  "GRAIN",
  "GRAND",
  "GRANT",
  "GRAPE",
  "GRAPH",
  "GRASP",
  "GRASS",
  "GRATE",
  "GRAVE",
  "GRAVY",
  "GRAZE",
  "GREAT",
  "GREEN",
  "GREET",
  "GRIEF",
  "GRILL",
  "GRIME",
  "GRIND",
  "GRIPE",
  "GROAN",
  "GROIN",
  "GROOM",
  "GROPE",
  "GROSS",
  "GROUP",
  "GROUT",
  "GROVE",
  "GROWL",
  "GRUEL",
  "GRUFF",
  "GRUNT",
  "GUARD",
  "GUESS",
  "GUEST",
  "GUIDE",
  "GUILD",
  "GUILT",
  "GUILE",
  "GULLY",
  "GUMBO",
  "GUMMY",
  "GUPPY",
  "GUSTO",
  "GYPSY",
  "HABIT",
  "HAIRY",
  "HALON",
  "HALVE",
  "HANDS",
  "HANDY",
  "HAPPY",
  "HARDY",
  "HARSH",
  "HATCH",
  "HATER",
  "HAVEN",
  "HAZEL",
  "HEADY",
  "HEARD",
  "HEART",
  "HEATH",
  "HEAVY",
  "HEDGE",
  "HEFTY",
  "HEIST",
  "HELIX",
  "HELLO",
  "HENCE",
  "HERON",
  "HONEY",
  "HONOR",
  "HORDE",
  "HORSE",
  "HOTEL",
  "HOUSE",
  "HOVER",
  "HUMAN",
  "HUMID",
  "HUMOR",
  "HUMUS",
  "HUNCH",
  "HUSKY",
  "HUSSY",
  "HUTCH",
  "HYDRA",
  "HYENA",
  "HYDRO",
  "ICIER",
  "ICING",
  "IDEAL",
  "IDIOM",
  "IDIOT",
  "IDLER",
  "IDYLL",
  "IGLOO",
  "IMAGE",
  "IMBUE",
  "IMPEL",
  "IMPLY",
  "INANE",
  "INBOX",
  "INCUR",
  "INDEX",
  "INEPT",
  "INERT",
  "INFER",
  "INFRA",
  "INGOT",
  "INLAY",
  "INLET",
  "INNER",
  "INPUT",
  "INTER",
  "INTRO",
  "IONIC",
  "IRATE",
  "IRONY",
  "ISLET",
  "ISSUE",
  "ITCHY",
  "IVORY",
  "JAZZY",
  "JELLY",
  "JERKY",
  "JETTY",
  "JEWEL",
  "JOKER",
  "JOLLY",
  "JOUST",
  "JUDGE",
  "JUICE",
  "JUMBO",
  "JUMPY",
  "JUNTA",
  "JUROR",
  "KARMA",
  "KAYAK",
  "KEBAB",
  "KHAKI",
  "KIOSK",
  "KITTY",
  "KNACK",
  "KNAVE",
  "KNEAD",
  "KNEEL",
  "KNELT",
  "KNIFE",
  "KNOCK",
  "KNOLL",
  "KNOWN",
  "KOALA",
  "KRILL",
  "LABEL",
  "LABOR",
  "LADEN",
  "LADLE",
  "LAGER",
  "LAKES",
  "LAMBS",
  "LAMENT",
  "LAMPS",
  "LANCE",
  "LANDS",
  "LAPEL",
  "LAPSE",
  "LARCH",
  "LARGE",
  "LARVA",
  "LASER",
  "LASSO",
  "LASTS",
  "LATCH",
  "LATER",
  "LATEX",
  "LATTE",
  "LAUGH",
  "LAYER",
  "LEAFY",
  "LEAGUE",
  "LEAKY",
  "LEARN",
  "LEASE",
  "LEASH",
  "LEAST",
  "LEAVE",
  "LEDGE",
  "LEECH",
  "LEERY",
  "LEFTY",
  "LEGAL",
  "LEGGY",
  "LEMON",
  "LEMUR",
  "LEPER",
  "LEVEL",
  "LEVER",
  "LIBEL",
  "LIEGE",
  "LIVER",
  "LIVES",
  "LIVID",
  "LLAMA",
  "LOAMY",
  "LOBBY",
  "LOCAL",
  "LOCUS",
  "LODGE",
  "LOFTY",
  "LOGIC",
  "LOGIN",
  "LOOMS",
  "LOONY",
  "LOOSE",
  "LORRY",
  "LOSER",
  "LOTUS",
  "LOUSE",
  "LOUSY",
  "LOVER",
  "LOWER",
  "LOYAL",
  "LUCID",
  "LUCKY",
  "LUMEN",
  "LUMPY",
  "LUNAR",
  "LUNCH",
  "LUNGE",
  "LUPUS",
  "LURCH",
  "LURID",
  "LURK",
  "LUSTY",
  "LYING",
  "LYMPH",
  "LYRIC",
  "MACAW",
  "MACRO",
  "MADAM",
  "MADLY",
  "MAFIA",
  "MAGIC",
  "MAGMA",
  "MAJOR",
  "MAKER",
  "MAMBO",
  "MAMMA",
  "MANGA",
  "MANGE",
  "MANGO",
  "MANGY",
  "MANIA",
  "MANIC",
  "MANOR",
  "MAPLE",
  "MARCH",
  "MARRY",
  "MARSH",
  "MASON",
  "MASSE",
  "MATCH",
  "MATEY",
  "MATRIX",
  "MATTE",
  "MAUVE",
  "MAXIM",
  "MAYBE",
  "MAYOR",
  "MEALS",
  "MEALY",
  "MEANT",
  "MEATS",
  "MELON",
  "MELTS",
  "MEMOR",
  "MERCY",
  "MERGE",
  "MERIT",
  "MERRY",
  "METAL",
  "METER",
  "METRO",
  "MICRO",
  "MIDGE",
  "MIDST",
  "MIGHT",
  "MILKY",
  "MIMIC",
  "MINCE",
  "MINER",
  "MINOR",
  "MINTY",
  "MINUS",
  "MIRTH",
  "MISER",
  "MISSY",
  "MISTY",
  "MIXER",
  "MOCHA",
  "MODEL",
  "MODEM",
  "MODES",
  "MOGUL",
  "MOIST",
  "MOLAR",
  "MOLDS",
  "MOLDY",
  "MOLES",
  "MOLTS",
  "MONKS",
  "MONTH",
  "MOOSE",
  "MORAL",
  "MORON",
  "MORPH",
  "MOSSY",
  "MOTEL",
  "MOTOR",
  "MOTTO",
  "MOUND",
  "MOUNT",
  "MOURN",
  "MOUSE",
  "MOUTH",
  "MOVER",
  "MOVIE",
  "MOWER",
  "MUCKY",
  "MUCUS",
  "MUDDY",
  "MUSIC",
  "MUSTY",
  "MYRRH",
  "NACHO",
  "NADIR",
  "NAIVE",
  "NANNY",
  "NASAL",
  "NAVEL",
  "NEEDS",
  "NEEDY",
  "NEIGH",
  "NERVE",
  "NEVER",
  "NEWER",
  "NEWLY",
  "NEXUS",
  "NICER",
  "NICHE",
  "NIECE",
  "NIGHT",
  "NINJA",
  "NINNY",
  "NINTH",
  "NOBLE",
  "NOBLY",
  "NOISE",
  "NOISY",
  "NOMAD",
  "NOOSE",
  "NORTH",
  "NOSEY",
  "NOTCH",
  "NOVEL",
  "NUDGE",
  "NURSE",
  "NUTTY",
  "NYLON",
  "OAKEN",
  "OARED",
  "OASIS",
  "OBESE",
  "OCCUR",
  "OCEAN",
  "OCTAL",
  "OCTET",
  "ODDER",
  "ODDLY",
  "ODORS",
  "OFFAL",
  "OFFER",
  "OFTEN",
  "OLIVE",
  "OMEGA",
  "ONION",
  "ONSET",
  "OPERA",
  "OPINE",
  "OPIUM",
  "OPTED",
  "OPTIC",
  "ORBIT",
  "ORDER",
  "ORGAN",
  "OTHER",
  "OTTER",
  "OUGHT",
  "OUNCE",
  "OUTER",
  "OVARY",
  "OVATE",
  "OVERT",
  "OWING",
  "OWNER",
  "OXIDE",
  "OZONE",
  "PADDY",
  "PAGAN",
  "PAINT",
  "PALER",
  "PALMS",
  "PANEL",
  "PANIC",
  "PAPER",
  "PARKA",
  "PARRY",
  "PARSE",
  "PARTY",
  "PASTA",
  "PASTE",
  "PASTY",
  "PATCH",
  "PATIO",
  "PAUSE",
  "PEACE",
  "PEACH",
  "PEARL",
  "PECAN",
  "PEDAL",
  "PENAL",
  "PENCE",
  "PENNY",
  "PERCH",
  "PERIL",
  "PERKY",
  "PESKY",
  "PESTO",
  "PETAL",
  "PETTY",
  "PHASE",
  "PHONE",
  "PHOTO",
  "PIANO",
  "PICKY",
  "PIECE",
  "PIETY",
  "PILOT",
  "PIPER",
  "PITCH",
  "PITHY",
  "PIVOT",
  "PIXEL",
  "PIXIE",
  "PIZZA",
  "PLACE",
  "PLAID",
  "PLAIN",
  "PLAIT",
  "PLANE",
  "PLANK",
  "PLANT",
  "PLATE",
  "PLAZA",
  "PLEAD",
  "PLEAT",
  "PLIED",
  "PLIER",
  "PLIES",
  "PLUCK",
  "PLUMB",
  "PLUME",
  "PLUMP",
  "PLUMS",
  "PLUSH",
  "POINT",
  "POISE",
  "POLAR",
  "POLKA",
  "POLYP",
  "POOCH",
  "POPPY",
  "PORCH",
  "POSED",
  "POSER",
  "POSIT",
  "POSSE",
  "POTTY",
  "POUCH",
  "POUND",
  "POWER",
  "PRANK",
  "PRAWN",
  "PREEN",
  "PRESS",
  "PRICE",
  "PRICK",
  "PRIDE",
  "PRIED",
  "PRIME",
  "PRINT",
  "PRIOR",
  "PRISM",
  "PRIVY",
  "PRIZE",
  "PROBE",
  "PROSE",
  "PROUD",
  "PROVE",
  "PROWL",
  "PRUDE",
  "PRUNE",
  "PSALM",
  "PULSE",
  "PUNCH",
  "PUPIL",
  "PUPPY",
  "PUREE",
  "PURER",
  "PURGE",
  "PURITY",
  "PURSE",
  "PUSHY",
  "PUTTY",
  "PYGMY",
  "QUACK",
  "QUAIL",
  "QUAKE",
  "QUALM",
  "QUARK",
  "QUART",
  "QUASH",
  "QUASI",
  "QUEEN",
  "QUEER",
  "QUELL",
  "QUERY",
  "QUEST",
  "QUEUE",
  "QUICK",
  "QUIET",
  "QUILL",
  "QUILT",
  "QUITE",
  "QUOTA",
  "QUOTE",
  "QUOTH",
  "RABBI",
  "RABID",
  "RACER",
  "RADAR",
  "RADIO",
  "RADON",
  "RAINY",
  "RAISE",
  "RALLY",
  "RAMEN",
  "RANCH",
  "RANGE",
  "RANKS",
  "RAPID",
  "RARER",
  "RASPY",
  "RATIO",
  "RAVEN",
  "RAYON",
  "RAZOR",
  "REACH",
  "REACT",
  "READY",
  "REALM",
  "REBEL",
  "REBUS",
  "RECAP",
  "RECON",
  "RECTO",
  "RECUR",
  "REDID",
  "REEDY",
  "REFER",
  "REFIT",
  "REGAL",
  "REHAB",
  "REIGN",
  "RELAX",
  "RELAY",
  "RELIC",
  "REMIT",
  "RENAL",
  "RENEW",
  "REPAY",
  "REPEL",
  "REPLY",
  "RERUN",
  "RESET",
  "RESIN",
  "RETRO",
  "RETRY",
  "REUSE",
  "REVEL",
  "REVUE",
  "RHINO",
  "RHYME",
  "RIDER",
  "RIDGE",
  "RIFLE",
  "RIGHT",
  "RIGID",
  "RIPEN",
  "RIPER",
  "RISEN",
  "RISER",
  "RIVER",
  "RIVET",
  "ROACH",
  "ROAST",
  "ROBOT",
  "ROCKY",
  "RODEO",
  "ROGUE",
  "ROOST",
  "ROTOR",
  "ROUND",
  "ROUSE",
  "ROUTE",
  "ROVER",
  "ROWER",
  "ROYAL",
  "RUDDY",
  "RUGBY",
  "RUINS",
  "RULED",
  "RULER",
  "RUMBA",
  "RUMOR",
  "RUNNY",
  "RURAL",
  "RUSTY",
  "SADLY",
  "SAFER",
  "SAINT",
  "SALAD",
  "SALON",
  "SALSA",
  "SALTY",
  "SALVO",
  "SANDY",
  "SANER",
  "SASSY",
  "SATIN",
  "SAUCE",
  "SAUCY",
  "SAUNA",
  "SAUTE",
  "SAVED",
  "SAVER",
  "SAVOR",
  "SAVVY",
  "SCALD",
  "SCALE",
  "SCALP",
  "SCALY",
  "SCAMP",
  "SCANT",
  "SCARE",
  "SCARF",
  "SCARY",
  "SCENE",
  "SCENT",
  "SCION",
  "SCOFF",
  "SCOLD",
  "SCONE",
  "SCOOP",
  "SCOPE",
  "SCORE",
  "SCORN",
  "SCOUR",
  "SCOUT",
  "SCOWL",
  "SCREW",
  "SCRUB",
  "SCUBA",
  "SEDAN",
  "SEEDY",
  "SEEMS",
  "SEIZE",
  "SENSE",
  "SEPIA",
  "SERIF",
  "SERUM",
  "SERVE",
  "SETUP",
  "SEVEN",
  "SEWER",
  "SHACK",
  "SHADE",
  "SHADY",
  "SHAFT",
  "SHAKE",
  "SHAKY",
  "SHALE",
  "SHALL",
  "SHALT",
  "SHAME",
  "SHANK",
  "SHAPE",
  "SHARD",
  "SHARE",
  "SHARK",
  "SHARP",
  "SHAVE",
  "SHAWL",
  "SHEAR",
  "SHEEN",
  "SHEEP",
  "SHEER",
  "SHEET",
  "SHELF",
  "SHELL",
  "SHIED",
  "SHIFT",
  "SHINE",
  "SHINY",
  "SHIRE",
  "SHIRK",
  "SHIRT",
  "SHOAL",
  "SHOCK",
  "SHONE",
  "SHOOK",
  "SHOOT",
  "SHORE",
  "SHORT",
  "SHOUT",
  "SHOVE",
  "SHOWN",
  "SHOWY",
  "SHREW",
  "SHRUB",
  "SHRUG",
  "SHYLY",
  "SIEGE",
  "SIGHT",
  "SIGMA",
  "SILKY",
  "SILLY",
  "SINCE",
  "SINEW",
  "SINGE",
  "SIREN",
  "SISSY",
  "SIXTH",
  "SIXTY",
  "SKATE",
  "SKIER",
  "SKIFF",
  "SKILL",
  "SKIMP",
  "SKIRT",
  "SKULL",
  "SKUNK",
  "SLACK",
  "SLAIN",
  "SLAKE",
  "SLANG",
  "SLANT",
  "SLASH",
  "SLATE",
  "SLAVE",
  "SLEEK",
  "SLEEP",
  "SLEET",
  "SLEPT",
  "SLICE",
  "SLICK",
  "SLIDE",
  "SLIME",
  "SLIMY",
  "SLING",
  "SLINK",
  "SLICE",
  "SLOPE",
  "SLOTH",
  "SLUMP",
  "SMACK",
  "SMALL",
  "SMART",
  "SMASH",
  "SMEAR",
  "SMELL",
  "SMELT",
  "SMILE",
  "SMIRK",
  "SMITH",
  "SMOKE",
  "SMOKY",
  "SMOTE",
  "SNACK",
  "SNAIL",
  "SNAKE",
  "SNEAK",
  "SNEER",
  "SNIDE",
  "SNIFF",
  "SNIPE",
  "SNOOP",
  "SNOOT",
  "SNOOZ",
  "SNUCK",
  "SNUFF",
  "SOAPY",
  "SOBER",
  "SOGGY",
  "SOLAR",
  "SOLID",
  "SOLVE",
  "SONAR",
  "SONIC",
  "SOOTH",
  "SOOTY",
  "SORRY",
  "SOUND",
  "SOUTH",
  "SOWER",
  "SPACE",
  "SPADE",
  "SPARK",
  "SPARE",
  "SPEAK",
  "SPEAR",
  "SPECK",
  "SPEED",
  "SPELL",
  "SPEND",
  "SPENT",
  "SPERM",
  "SPICE",
  "SPICY",
  "SPIED",
  "SPIEL",
  "SPIKE",
  "SPIKY",
  "SPILL",
  "SPILT",
  "SPINE",
  "SPINY",
  "SPIRE",
  "SPITE",
  "SPLAT",
  "SPLIT",
  "SPOIL",
  "SPOKE",
  "SPOOF",
  "SPOOK",
  "SPOOL",
  "SPOON",
  "SPORE",
  "SPORT",
  "SPOTS",
  "SPOUT",
  "SPRAY",
  "SPREE",
  "SPRIG",
  "SPUNK",
  "SPURN",
  "SPURS",
  "SQUAD",
  "SQUAT",
  "SQUIB",
  "SQUID",
  "STACK",
  "STAFF",
  "STAGE",
  "STAIN",
  "STAKE",
  "STALE",
  "STALK",
  "STALL",
  "STAMP",
  "STAND",
  "STANK",
  "STARE",
  "STARK",
  "START",
  "STASH",
  "STATE",
  "STAVE",
  "STEAD",
  "STEAK",
  "STEAL",
  "STEAM",
  "STEED",
  "STEEL",
  "STEEP",
  "STEER",
  "STEIN",
  "STEMS",
  "STERN",
  "STICK",
  "STIFF",
  "STILL",
  "STILT",
  "STING",
  "STINK",
  "STINT",
  "STOCK",
  "STOIC",
  "STOKE",
  "STOLE",
  "STOMP",
  "STONE",
  "STONY",
  "STOOD",
  "STOOL",
  "STOOP",
  "STOPS",
  "STORE",
  "STORK",
  "STORM",
  "STORY",
  "STOUT",
  "STOVE",
  "STRAP",
  "STRAW",
  "STRAY",
  "STRIP",
  "STUCK",
  "STUDY",
  "STUFF",
  "STUMP",
  "STUNG",
  "STUNT",
  "STYLE",
  "SUAVE",
  "SUGAR",
  "SUING",
  "SUITE",
  "SUITS",
  "SULKY",
  "SULLY",
  "SUNNY",
  "SUPER",
  "SURER",
  "SURGE",
  "SURLY",
  "SUSHI",
  "SWAMI",
  "SWAMP",
  "SWARM",
  "SWASH",
  "SWATH",
  "SWEAR",
  "SWEAT",
  "SWEEP",
  "SWEET",
  "SWELL",
  "SWEPT",
  "SWIFT",
  "SWILL",
  "SWINE",
  "SWING",
  "SWIRL",
  "SWISH",
  "SWOON",
  "SWOOP",
  "SWORD",
  "SWORE",
  "SWORN",
  "SWUNG",
  "SYNOD",
  "TABLE",
  "TABOO",
  "TACIT",
  "TACKY",
  "TAFFY",
  "TAINT",
  "TAKEN",
  "TALON",
  "TAMER",
  "TANGO",
  "TANGY",
  "TAPER",
  "TAPIR",
  "TARDY",
  "TAROT",
  "TASTE",
  "TASTY",
  "TATTY",
  "TAUNT",
  "TAWNY",
  "TEACH",
  "TEARY",
  "TEASE",
  "TEDDY",
  "TEETH",
  "TEPID",
  "TERRA",
  "TERSE",
  "TESTY",
  "THANK",
  "THEFT",
  "THEIR",
  "THEME",
  "THERE",
  "THESE",
  "THICK",
  "THIEF",
  "THIGH",
  "THING",
  "THINK",
  "THIRD",
  "THORN",
  "THOSE",
  "THREE",
  "THREW",
  "THROB",
  "THROW",
  "THRUM",
  "THUMB",
  "THUMP",
  "THYME",
  "TIARA",
  "TIBIA",
  "TIDAL",
  "TIDED",
  "TIDES",
  "TIERS",
  "TIFFS",
  "TIGHT",
  "TILDE",
  "TILED",
  "TILES",
  "TIMER",
  "TIMES",
  "TIMID",
  "TINGE",
  "TIPSY",
  "TIRED",
  "TIRES",
  "TITAN",
  "TITLE",
  "TOAST",
  "TODAY",
  "TOKEN",
  "TOLLS",
  "TOMBS",
  "TONAL",
  "TONGA",
  "TONGS",
  "TONIC",
  "TOOLS",
  "TOOTH",
  "TOPAZ",
  "TOPIC",
  "TORCH",
  "TORSO",
  "TOTAL",
  "TOTEM",
  "TOUCH",
  "TOUGH",
  "TOURS",
  "TOWEL",
  "TOWER",
  "TOWNS",
  "TOXIC",
  "TRACE",
  "TRACK",
  "TRACT",
  "TRADE",
  "TRAIL",
  "TRAIN",
  "TRAIT",
  "TRAMP",
  "TRASH",
  "TRAWL",
  "TREAT",
  "TREND",
  "TRIAD",
  "TRIAL",
  "TRIBE",
  "TRICK",
  "TRIED",
  "TRIER",
  "TRIPE",
  "TRITE",
  "TROOP",
  "TROPE",
  "TROUT",
  "TROVE",
  "TRUCE",
  "TRUCK",
  "TRUER",
  "TRULY",
  "TRUMP",
  "TRUNK",
  "TRUST",
  "TRUTH",
  "TUBER",
  "TULIP",
  "TUMOR",
  "TUNIC",
  "TURBO",
  "TUTOR",
  "TWAIN",
  "TWEAK",
  "TWEED",
  "TWEEP",
  "TWICE",
  "TWINE",
  "TWIRL",
  "TWIST",
  "TYING",
  "UDDER",
  "ULCER",
  "ULTRA",
  "UMBRA",
  "UNCLE",
  "UNCUT",
  "UNDER",
  "UNDUE",
  "UNFIT",
  "UNIFY",
  "UNION",
  "UNITE",
  "UNITY",
  "UNTIE",
  "UNTIL",
  "UPPER",
  "UPSET",
  "URBAN",
  "URINE",
  "USAGE",
  "USUAL",
  "USURP",
  "UTTER",
  "VAGUE",
  "VALET",
  "VALID",
  "VALOR",
  "VALUE",
  "VALVE",
  "VAPOR",
  "VAULT",
  "VAUNT",
  "VEGAN",
  "VEINS",
  "VEINY",
  "VELDT",
  "VELUM",
  "VENOM",
  "VENUE",
  "VERGE",
  "VERSE",
  "VERSO",
  "VERVE",
  "VESTS",
  "VEXED",
  "VIALS",
  "VIBES",
  "VICAR",
  "VICED",
  "VICES",
  "VIDEO",
  "VIEWS",
  "VIGIL",
  "VIGOR",
  "VILLA",
  "VINES",
  "VINYL",
  "VIOLA",
  "VIPER",
  "VIRAL",
  "VIRUS",
  "VISAS",
  "VIXEN",
  "VOCAL",
  "VODKA",
  "VOGUE",
  "VOICE",
  "VOILA",
  "VOLAR",
  "VOLTS",
  "VOTED",
  "VOTER",
  "VOTES",
  "VOUCH",
  "VOWEL",
  "VYING",
  "WACKY",
  "WAFER",
  "WAGER",
  "WAGON",
  "WAIST",
  "WAIVE",
  "WAKED",
  "WAKEN",
  "WAKES",
  "WALKS",
  "WALLS",
  "WALTZ",
  "WARTY",
  "WASTE",
  "WATCH",
  "WATER",
  "WATTS",
  "WAVER",
  "WAVES",
  "WEAKS",
  "WEARY",
  "WEAVE",
  "WEDGE",
  "WEEDS",
  "WEEDY",
  "WEEKS",
  "WEEPS",
  "WEEPY",
  "WEIGH",
  "WEIRD",
  "WELCH",
  "WELDS",
  "WELLS",
  "WELSH",
  "WHEAT",
  "WHEEL",
  "WHELP",
  "WHERE",
  "WHICH",
  "WHIFF",
  "WHILE",
  "WHINE",
  "WHINY",
  "WHIRL",
  "WHISK",
  "WHITE",
  "WHOLE",
  "WHOOP",
  "WHOSE",
  "WIDEN",
  "WIDER",
  "WIDOW",
  "WIDTH",
  "WIELD",
  "WIGHT",
  "WILLY",
  "WIMPS",
  "WIMPY",
  "WINCE",
  "WINCH",
  "WINDS",
  "WINDY",
  "WINES",
  "WINGS",
  "WINKS",
  "WINTER",
  "WIPED",
  "WIPER",
  "WIPES",
  "WIRED",
  "WIRER",
  "WIRES",
  "WISER",
  "WISPY",
  "WITCH",
  "WITTY",
  "WOKEN",
  "WOMAN",
  "WOMBS",
  "WOMEN",
  "WOODS",
  "WOODY",
  "WOOED",
  "WOOER",
  "WOOLY",
  "WOOZY",
  "WORDS",
  "WORDY",
  "WORKS",
  "WORLD",
  "WORMS",
  "WORMY",
  "WORRY",
  "WORSE",
  "WORST",
  "WORTH",
  "WOULD",
  "WOUND",
  "WOVEN",
  "WRACK",
  "WRATH",
  "WREAK",
  "WRECK",
  "WREST",
  "WRING",
  "WRIST",
  "WRITE",
  "WRITS",
  "WRONG",
  "WROTE",
  "WRUNG",
  "YACHT",
  "YARDS",
  "YEARN",
  "YEAST",
  "YELLS",
  "YIELD",
  "YODEL",
  "YOKEL",
  "YOUNG",
  "YOURS",
  "YOUTH",
  "ZAPPY",
  "ZEBRA",
  "ZESTY",
  "ZILCH",
  "ZINCY",
  "ZIPPY",
  "ZONAL",
  "ZONED",
  "ZONES",
  "ZOOEY",
  "ZOWIE",
]);

// 主题词库
const THEMATIC_WORDS: Record<string, string[]> = {
  animals: [
    "HORSE",
    "SHEEP",
    "GOAT",
    "COW",
    "PIG",
    "DOG",
    "CAT",
    "BIRD",
    "FISH",
    "MOUSE",
    "RABBIT",
    "BEAR",
    "LION",
    "TIGER",
    "ELEPHANT",
    "WHALE",
    "SHARK",
    "DOLPHIN",
    "EAGLE",
    "HAWK",
  ],
  colors: [
    "BLACK",
    "WHITE",
    "GREEN",
    "BLUE",
    "RED",
    "BROWN",
    "GRAY",
    "PINK",
    "YELLOW",
    "PURPLE",
    "ORANGE",
    "MAGENTA",
    "CYAN",
    "SCARLET",
    "CRIMSON",
    "INDIGO",
    "VIOLET",
    "MAROON",
    "OLIVE",
    "NAVY",
  ],
  nature: [
    "GRASS",
    "LEAF",
    "STEM",
    "BRANCH",
    "STONE",
    "ROCK",
    "SAND",
    "CEMENT",
    "METAL",
    "STEEL",
    "IRON",
    "BRICK",
    "GLASS",
    "WATER",
    "OCEAN",
    "RIVER",
    "LAKE",
    "MOUNTAIN",
    "VALLEY",
    "FOREST",
  ],
  food: [
    "APPLE",
    "GRAPE",
    "LEMON",
    "MANGO",
    "BERRY",
    "MELON",
    "PEACH",
    "CHERRY",
    "BREAD",
    "PIZZA",
    "SALAD",
    "PASTA",
    "RICE",
    "FLOUR",
    "OATS",
    "COFFEE",
    "TEA",
    "JUICE",
    "BEEF",
    "LAMB",
  ],
  emotions: [
    "HAPPY",
    "SAD",
    "ANGRY",
    "SCARED",
    "SURPRISED",
    "EXCITED",
    "TIRED",
    "BORING",
    "INTERESTING",
    "FUNNY",
    "SILLY",
    "SMART",
    "STUPID",
    "BEAUTIFUL",
    "WONDERFUL",
    "AMAZING",
    "TERRIBLE",
    "EXCELLENT",
    "HORRIBLE",
    "FANTASTIC",
  ],
};

// 根据日期生成确定性伪随机数
function seededRandom(seed: string): number {
  let hash = 0;
  for (let i = 0; i < seed.length; i++) {
    const char = seed.charCodeAt(i);
    hash = (hash << 5) - hash + char;
    hash = hash & hash;
  }
  return Math.abs(hash);
}

// 从数组中根据种子选择确定数量的项目
function selectBySeed<T>(array: T[], count: number, seed: string): T[] {
  const random = seededRandom(seed);
  const result = [...array];
  const selected: T[] = [];

  // 如果数组为空，返回空数组
  if (result.length === 0) {
    return selected;
  }

  // 循环次数不能超过数组长度
  const iterations = Math.min(count, result.length);

  for (let i = 0; i < iterations; i++) {
    const index = (random + i * 9973) % result.length;
    selected.push(result[index]);
    result.splice(index, 1);
  }

  return selected;
}

/**
 * 加载词库文件
 */
export async function loadWordList(filename: string): Promise<string[]> {
  try {
    if (filename === "wordle-official.txt") {
      return Array.from(COMMON_5_LETTER_WORDS);
    }

    // 实际读取 enable1.txt 文件
    if (filename === "enable1.txt") {
      const filePath = path.join(
        process.cwd(),
        "public",
        "wordlists",
        filename,
      );
      const text = await fs.readFile(filePath, "utf-8");
      const words = text
        .split("\n")
        .map((word) => word.trim().toUpperCase())
        .filter(
          (word) =>
            word.length >= 3 && word.length <= 8 && /^[A-Z]+$/.test(word),
        );
      return words;
    }

    // 默认返回通用词库
    return Array.from(COMMON_5_LETTER_WORDS);
  } catch (error) {
    console.error(`Failed to load wordlist ${filename}:`, error);
    return Array.from(COMMON_5_LETTER_WORDS);
  }
}

/**
 * 分类单词
 */
export function categorizeWords(words: string[]): {
  easy: string[];
  medium: string[];
  hard: string[];
} {
  const easy: string[] = [];
  const medium: string[] = [];
  const hard: string[] = [];

  words.forEach((word) => {
    if (COMMON_5_LETTER_WORDS.has(word)) {
      // 前30%为简单
      if (easy.length < words.length * 0.3) {
        easy.push(word);
      }
      // 中间50%为中等
      else if (medium.length < words.length * 0.5) {
        medium.push(word);
      }
      // 剩余20%为困难
      else {
        hard.push(word);
      }
    }
  });

  // 确保每个分类至少有一些单词
  if (easy.length === 0) easy.push(...words.slice(0, 10));
  if (medium.length === 0) medium.push(...words.slice(10, 50));
  if (hard.length === 0) hard.push(...words.slice(50, 100));

  return { easy, medium, hard };
}

/**
 * 按主题过滤单词
 */
export function filterByTheme(words: string[], theme?: string): string[] {
  if (!theme) return words;

  const thematicWords = THEMATIC_WORDS[theme.toLowerCase()];
  if (!thematicWords) return words;

  return words.filter((word) => thematicWords.includes(word));
}

/**
 * 生成Quordle每日单词
 * 使用高级词库系统
 */
export async function generateDailyWordsAdvanced(
  difficulty: "beginner" | "intermediate" | "expert" = "intermediate",
  date?: string,
  theme?: string,
) {
  const today = date || new Date().toISOString().split("T")[0];

  // 加载词库
  const wordList = await loadWordList("wordle-official.txt");

  // 按主题过滤
  const filteredWords = filterByTheme(wordList, theme);

  // 分类
  const categorized = categorizeWords(filteredWords);

  // 根据难度映射
  let difficultyMap: "easy" | "medium" | "hard";
  switch (difficulty) {
    case "beginner":
      difficultyMap = "easy";
      break;
    case "expert":
      difficultyMap = "hard";
      break;
    default:
      difficultyMap = "medium";
  }

  // 使用确定性选择
  const words = selectBySeed(categorized[difficultyMap], 4, today);

  return {
    words: {
      easy:
        difficultyMap === "easy"
          ? words
          : selectBySeed(categorized.easy, 4, `${today}-easy`),
      medium:
        difficultyMap === "medium"
          ? words
          : selectBySeed(categorized.medium, 4, `${today}-medium`),
      hard:
        difficultyMap === "hard"
          ? words
          : selectBySeed(categorized.hard, 4, `${today}-hard`),
    },
    date: today,
    metadata: {
      generatedAt: new Date().toISOString(),
      source: "advanced-wordlist",
      difficulty,
      theme: theme || "general",
    },
  };
}

/**
 * 生成Squares每日谜题
 * 高级版本：使用DFS算法确保单词可找到
 */
export async function generateDailySquaresAdvanced(
  date?: string,
  theme?: string,
) {
  const today = date || new Date().toISOString().split("T")[0];

  // 加载词库
  const wordList = await loadWordList("enable1.txt");
  const filteredWords = filterByTheme(wordList, theme);

  // 使用确定性方式选择单词
  // 过滤出3-6个字母的单词（现在使用5x5网格，可以支持更多长度）
  const shortWords = filteredWords.filter(
    (word) => word.length >= 3 && word.length <= 6,
  );

  // 按长度分组，确保词长多样性
  const wordsByLength: Record<number, string[]> = {};
  for (let len = 3; len <= 6; len++) {
    wordsByLength[len] = shortWords.filter((w) => w.length === len);
  }

  // 确保选择的单词组合的unique letters <= 16（5x5网格容量）
  // 选择50个候选词（30个核心 + 20个奖励）
  // 使用分层抽样确保长度多样性，确保3-4字母单词至少有15个
  let selectedWords: string[] = [];
  const targetTotal = 50;

  // 为3-4字母单词分配更高权重（3字母10个，4字母8个）
  for (let len = 3; len <= 6; len++) {
    const availableWords = wordsByLength[len];
    if (availableWords.length > 0) {
      // 3字母至少10个，4字母至少8个，5-6字母至少1个
      const minWordsPerLength = len === 3 ? 10 : len === 4 ? 8 : 1;
      const seedSuffix = `${today}-len${len}-mandatory`;
      const selectedForLength = selectBySeed(
        availableWords,
        minWordsPerLength,
        seedSuffix,
      );
      selectedWords.push(...selectedForLength);
    }
  }

  // 计算剩余需要选择的单词数
  const remainingWordsToSelect = targetTotal - selectedWords.length;

  // 计算每个长度的权重（3-4字母获得极高权重）
  const totalWeightedWords = Object.entries(wordsByLength).reduce(
    (sum, [len, words]) => {
      const length = parseInt(len, 10);
      // 3字母权重为5.0，4字母权重为4.0，5字母权重为0.6，6字母权重为0.3
      const weight =
        length === 3 ? 5.0 : length === 4 ? 4.0 : length === 5 ? 0.6 : 0.3;
      return sum + words.length * weight;
    },
    0,
  );

  // 根据权重比例分配剩余单词
  for (let len = 3; len <= 6; len++) {
    const availableWords = wordsByLength[len];
    if (availableWords.length === 0) continue;

    // 计算这个长度的加权比例
    const weight = len === 3 ? 5.0 : len === 4 ? 4.0 : len === 5 ? 0.6 : 0.3;
    const weightedProportion =
      (availableWords.length * weight) / totalWeightedWords;

    // 根据权重计算应该额外选择多少个单词
    // 3-4字母至少额外8个单词，确保总共有15个以上
    const extraWordsForLength = Math.max(
      len <= 4 ? 8 : 1,
      Math.floor(weightedProportion * remainingWordsToSelect),
    );

    // 确保不超过可用单词数量
    const wordsToSelect = Math.min(
      extraWordsForLength,
      availableWords.length -
        selectedWords.filter((w) => w.length === len).length,
    );

    if (wordsToSelect > 0) {
      // 获取尚未选择的该长度单词
      const notSelectedWords = availableWords.filter(
        (w) => !selectedWords.includes(w),
      );

      const seedSuffix = `${today}-len${len}-extra`;
      const selectedForLength = selectBySeed(
        notSelectedWords,
        wordsToSelect,
        seedSuffix,
      );
      selectedWords.push(...selectedForLength);
    }
  }

  // 如果还没达到目标数量，补充选择
  if (selectedWords.length < targetTotal) {
    const remaining = targetTotal - selectedWords.length;
    const remainingWords = shortWords.filter((w) => !selectedWords.includes(w));
    const additional = selectBySeed(
      remainingWords,
      remaining,
      `${today}-remaining`,
    );
    selectedWords.push(...additional);
  }

  // 按长度统计最终选择的单词
  const selectedByLength: Record<number, number> = {};
  for (let len = 3; len <= 6; len++) {
    selectedByLength[len] = selectedWords.filter(
      (w) => w.length === len,
    ).length;
  }

  // 检查unique letters数量，如果>16则过滤
  let uniqueLetters = [
    ...new Set(selectedWords.join("").toUpperCase().split("")),
  ];
  if (uniqueLetters.length > 16) {
    // 重新选择，直到unique letters <= 16
    let attempts = 0;
    while (attempts < 50) {
      const targetCount = Math.max(20, 50 - attempts * 2);
      const tempWords = selectBySeed(shortWords, targetCount, today);
      const tempUnique = [
        ...new Set(tempWords.join("").toUpperCase().split("")),
      ];

      // 如果unique letters <= 16，或者已经尝试了很多次，就接受这个结果
      if (tempUnique.length <= 16 || attempts >= 30) {
        selectedWords = tempWords;
        uniqueLetters = tempUnique;
        break;
      }
      attempts++;
    }
  }

  // 构建4x4网格，确保所有单词都能找到
  const { grid, findableWords } = await buildVerifiableGrid(selectedWords);

  return {
    grid,
    words: findableWords,
    date: today,
    metadata: {
      generatedAt: new Date().toISOString(),
      source: "advanced-wordlist",
      theme: theme || "general",
      verified: true,
    },
  };
}

/**
 * 使用DFS算法构建可验证的网格
 */
async function buildVerifiableGrid(words: string[]): Promise<{
  grid: string[];
  findableWords: string[];
}> {
  // 导入智能网格生成器
  const { generateOptimalGrid } = await import("./squares-dfs-generator");

  // 过滤出3-6字母单词（现在使用5x5网格，可以支持更丰富的长度）
  const mediumWords = words.filter((w) => w.length >= 3 && w.length <= 6);

  // 按长度分组，确保3-4字母单词至少有15个
  const threeLetterWords = mediumWords.filter((w) => w.length === 3);
  const fourLetterWords = mediumWords.filter((w) => w.length === 4);
  const fiveLetterWords = mediumWords.filter((w) => w.length === 5);
  const sixLetterWords = mediumWords.filter((w) => w.length === 6);

  // 选择至少15个3-4字母单词（3字母12个，4字母3个）
  const selectedThreeWords = threeLetterWords.slice(0, 12);
  const selectedFourWords = fourLetterWords.slice(0, 3);
  const selectedFiveWords = fiveLetterWords.slice(0, 10);

  // 总共选择50个单词进行尝试
  const selectedWords = [
    ...selectedThreeWords,
    ...selectedFourWords,
    ...selectedFiveWords,
    ...fiveLetterWords.slice(10, 25),
    ...sixLetterWords.slice(0, 10),
  ];

  // 使用智能DFS算法生成网格，增加尝试次数以找到更好的配置
  const result = generateOptimalGrid(selectedWords, 50);

  // 确保至少返回30个单词，并且3-4字母单词至少有15个
  let finalWords = [...new Set(result.foundWords)]; // 去除重复单词

  // 如果3-4字母单词不够，补充更多
  const threeFourWords = finalWords.filter((w) => w.length <= 4);
  if (threeFourWords.length < 15) {
    // 优先补充3-4字母单词
    const additionalThreeFour = mediumWords
      .filter((w) => w.length <= 4 && !finalWords.includes(w))
      .slice(0, 15 - threeFourWords.length);
    finalWords = [...finalWords, ...additionalThreeFour];
  }

  // 确保至少有30个单词
  if (finalWords.length < 30) {
    const additionalWords = mediumWords
      .filter((w) => !finalWords.includes(w))
      .slice(0, 30 - finalWords.length);
    finalWords = [...finalWords, ...additionalWords];
  }

  // 最终去重
  finalWords = [...new Set(finalWords)];

  return {
    grid: result.grid,
    findableWords: finalWords,
  };
}

/**
 * 检查单词是否在网格中可找到（使用DFS算法）
 */
function _canFindWordInGrid(word: string, grid: string[]): boolean {
  const wordUpper = word.toUpperCase();
  const visited = new Set<number>();

  const getNeighbors = (index: number): number[] => {
    const neighbors: number[] = [];
    const row = Math.floor(index / 5);
    const col = index % 5;

    for (let r = row - 1; r <= row + 1; r++) {
      for (let c = col - 1; c <= col + 1; c++) {
        if (r >= 0 && r < 5 && c >= 0 && c < 5) {
          const neighborIndex = r * 5 + c;
          if (neighborIndex !== index) {
            neighbors.push(neighborIndex);
          }
        }
      }
    }
    return neighbors;
  };

  const search = (index: number, wordIdx: number): boolean => {
    if (wordIdx === wordUpper.length) return true;
    if (grid[index] !== wordUpper[wordIdx]) return false;

    visited.add(index);
    const neighbors = getNeighbors(index);

    for (const neighbor of neighbors) {
      if (!visited.has(neighbor)) {
        if (search(neighbor, wordIdx + 1)) {
          visited.delete(index);
          return true;
        }
      }
    }

    visited.delete(index);
    return false;
  };

  // 尝试从每个格子开始搜索
  for (let i = 0; i < grid.length; i++) {
    if (grid[i] === wordUpper[0]) {
      visited.clear();
      if (search(i, 1)) return true;
    }
  }

  return false;
}

/**
 * 获取可用主题列表
 */
export function getAvailableThemes(): string[] {
  return Object.keys(THEMATIC_WORDS);
}

/**
 * 获取词库统计信息
 */
export function getWordListStats(): {
  totalWords: number;
  easyWords: number;
  mediumWords: number;
  hardWords: number;
  themes: string[];
} {
  const categorized = categorizeWords(Array.from(COMMON_5_LETTER_WORDS));

  return {
    totalWords: COMMON_5_LETTER_WORDS.size,
    easyWords: categorized.easy.length,
    mediumWords: categorized.medium.length,
    hardWords: categorized.hard.length,
    themes: Object.keys(THEMATIC_WORDS),
  };
}
